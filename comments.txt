Кирилл, привет! Большу часть работы я подготовил, но есть проблема!
Номера заказов stg.ordersystem_orders не соответствуют номерам заказов в stg.delivery
Запрос
"SELECT * FROM stg.delivery d
INNER JOIN stg.ordersystem_orders c
ON c.object_id = d.order_id;"
Возвращет NULL, поэтому при возмировании таблицы в слое dds возникнет проблема, так как для избежания излишних данных мне нужно заменить атрибут order_id на ключ по табилце dds.dm_orders/
Или я где то ошибся или проблема на стороне источника данных.
Можно это как-то уточнить???
и еще немного не понятно нужно ли заменять данные о ресторанах из mongo на данные о ресторанах из API. Пока оставил как есть.



Ну а пока на текущий момент:
Все дефолтные таблицы расположены за пределами требуемых слоев, поэтому создаем новые скрипты для новых слоев.
Для этого предусмотрена проверка и автогенерация недостающих таблиц на первом этапе.

При загрузке в стейджинг с инкрементои использованы два механизма:
    через max поле таблицы у размещенной в staging - для таблиц, которые мы загружаем их удаленной базы postgres
    через через метаданные в отдельной таблице - для таблиц, которые мы загружаем из MongoDB
    для таблицы с курьерами инкремент не предусмотрен в случае дублирования применяется констраинт unique на id и Insert on conflict
    Другой подход сейчас я придумать не смогу, и даже не уверен что есть смылс в таблице всего 2 поля id (varchar) и name (varchar)
    Потенциально измениться может только name, и то это большая редкость.
По схожей причине при загрузке данных в табилцу dds.dm_users невозможно определить критерий инкремента, пожно лишь залить новые данные.
Как поступать с дублями user_id было бы неплохо уточнить у аналитика, я данном случае скрипт подготовлен с учетом того, что у клиента могло поменяться имя.
Но возможно следует использовать конструкцию ON CONFLICT DO NOTHING

Сейчас dags еще не подключены, запуск выпоняется вручную как с обычными функциями.
Подключение настроено пока по простому через PythonOperator и через requests, но если нужно могу поправить на более профильные инструменты
Подключение к MongoDb выполняется с сертификатом SSL, размещенным в корневой папке с проектом, однако по понятным причинам я не прикладывал его к проекту